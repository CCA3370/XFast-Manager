<!DOCTYPE html>
<html lang="en" style="margin:0;padding:0;width:100%;height:100%;overflow:hidden;">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>XFast Manager - X-Plane Addon Auto Manager</title>
    <style>
      #loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        transition: opacity 0.3s ease-out;
      }

      #loading-screen.fade-out {
        opacity: 0;
        pointer-events: none;
      }

      .loader {
        width: 60px;
        height: 60px;
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top-color: #fff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        to { transform: rotate(360deg); }
      }

      .loading-text {
        margin-top: 20px;
        color: #fff;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        font-size: 16px;
        font-weight: 500;
        letter-spacing: 0.5px;
      }

      .app-title {
        margin-bottom: 40px;
        color: #fff;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        font-size: 28px;
        font-weight: 700;
        letter-spacing: 1px;
      }

      /* Error state styles - preloaded for JS crash scenarios */
      .error-text { color: #ff6b6b !important; }
      .loader.error-state {
        animation: none !important;
        border-color: #ff6b6b !important;
        border-top-color: #ff6b6b !important;
      }
      .error-container {
        margin-top: 30px;
        text-align: center;
        max-width: 500px;
        padding: 0 20px;
      }
      .error-message {
        color: #fff;
        font-size: 14px;
        margin-bottom: 10px;
        word-break: break-word;
      }
      .error-details {
        color: rgba(255,255,255,0.7);
        font-size: 12px;
        font-family: monospace;
        background: rgba(0,0,0,0.2);
        padding: 10px;
        border-radius: 4px;
        margin-bottom: 15px;
        max-height: 150px;
        overflow-y: auto;
        text-align: left;
        white-space: pre-wrap;
        word-break: break-all;
      }
      .error-hint {
        color: rgba(255,255,255,0.6);
        font-size: 12px;
        margin-bottom: 20px;
      }
      .error-buttons {
        display: flex;
        gap: 12px;
        justify-content: center;
      }
      .copy-button, .retry-button {
        background: rgba(255,255,255,0.2);
        border: 1px solid rgba(255,255,255,0.3);
        color: #fff;
        padding: 10px 30px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        transition: background 0.2s, border-color 0.2s;
      }
      .copy-button:hover, .retry-button:hover {
        background: rgba(255,255,255,0.3);
      }
      .copy-button.copied {
        background: rgba(76, 175, 80, 0.3);
        border-color: rgba(76, 175, 80, 0.5);
      }
    </style>
  </head>
  <body style="margin:0;padding:0;width:100%;height:100%;overflow:hidden;">
    <div id="loading-screen">
      <div class="app-title">XFast Manager</div>
      <div class="loader"></div>
      <div class="loading-text">Loading...</div>
    </div>
    <div id="app"></div>
    <script type="module" src="/src/main.ts"></script>
    <script>
      // Shared error display function for fallback handlers
      function showFallbackError(errorMsg, errorStack) {
        var loadingScreen = document.getElementById('loading-screen');
        if (!loadingScreen || loadingScreen.querySelector('.error-container')) return;

        var loadingText = loadingScreen.querySelector('.loading-text');
        if (loadingText) {
          loadingText.textContent = 'Initialization Failed';
          loadingText.classList.add('error-text');
        }

        var loader = loadingScreen.querySelector('.loader');
        if (loader) {
          loader.classList.add('error-state');
        }

        var errorContainer = document.createElement('div');
        errorContainer.className = 'error-container';
        loadingScreen.appendChild(errorContainer);

        var errorText = errorMsg + (errorStack ? '\n\n' + errorStack : '');

        errorContainer.innerHTML =
          '<div class="error-message">' + errorMsg.replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</div>' +
          (errorStack ? '<div class="error-details">' + errorStack.replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</div>' : '') +
          '<div class="error-hint">Check the log file for more details</div>' +
          '<div class="error-buttons">' +
            '<button class="copy-button" id="fallback-copy-btn">Copy Error</button>' +
            '<button class="retry-button" onclick="location.reload()">Retry</button>' +
          '</div>';

        window._fallbackErrorText = errorText;
        document.getElementById('fallback-copy-btn').onclick = function() {
          var btn = this;
          navigator.clipboard.writeText(window._fallbackErrorText).then(function() {
            btn.textContent = 'Copied!';
            btn.classList.add('copied');
            setTimeout(function() { btn.textContent = 'Copy Error'; btn.classList.remove('copied'); }, 2000);
          }).catch(function() {
            var ta = document.createElement('textarea');
            ta.value = window._fallbackErrorText;
            ta.style.cssText = 'position:fixed;opacity:0';
            document.body.appendChild(ta);
            ta.select();
            document.execCommand('copy');
            document.body.removeChild(ta);
            btn.textContent = 'Copied!';
            btn.classList.add('copied');
            setTimeout(function() { btn.textContent = 'Copy Error'; btn.classList.remove('copied'); }, 2000);
          });
        };
      }

      // Handle synchronous JS errors
      window.addEventListener('error', function(e) {
        var errorMsg = e.message || 'Unknown error';
        var errorStack = e.error && e.error.stack ? e.error.stack : '';
        showFallbackError(errorMsg, errorStack);
      }, true);

      // Handle unhandled promise rejections (module loading failures, async errors)
      window.addEventListener('unhandledrejection', function(e) {
        var errorMsg = 'Unhandled Promise Rejection';
        var errorStack = '';
        if (e.reason) {
          if (typeof e.reason === 'string') {
            errorMsg = e.reason;
          } else if (e.reason.message) {
            errorMsg = e.reason.message;
            errorStack = e.reason.stack || '';
          }
        }
        showFallbackError(errorMsg, errorStack);
      });
    </script>
  </body>
</html>
